generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("PRISMA_DATABASE_URL")
}

model User {
  id            String        @id @default(uuid())
  email         String        @unique
  password      String
  ip_address    String
  role          String        @default("USER") // USER, ADMIN
  points        Int           @default(20)
  referral_code String        @unique
  invited_by    String?
  created_at    DateTime      @default(now())
  
  codes         DynamicCode[]
  
  referrer      User?         @relation("Referrals", fields: [invited_by], references: [id])
  invitees      User[]        @relation("Referrals")
}

model DynamicCode {
  id             String   @id @default(uuid())
  user_id        String
  short_code     String   @unique
  type           String   // LINK or IMAGE
  target_content String
  active         Boolean  @default(true)
  visits         Int      @default(0)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  user           User     @relation(fields: [user_id], references: [id])
}
